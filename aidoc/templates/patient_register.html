{% extends "./base.html"%}

{% block title %} AIDOC | Patient Register {% endblock %}

{% block content %}
<div class="row d-flex align-items-center justify-content-center pt-4">
    <div class="card mb-4" style="width: max-content;">
        <div class="card-body">
            <h5 class="card-title">กรุณากรอกข้อมูลส่วนตัวของคนไข้</h5>
            <form class="my-4" action="{{ url_for('user.register', role='patient') }}" method="post" enctype="multipart/form-data">
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="name">ชื่อ (ไม่ต้องใส่คำนำหน้าชื่อ) <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" placeholder="ชื่อ..." name="name" id="name" value="{{data.name}}"required>
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="surname">นามสกุล <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" placeholder="นามสกุล..." name="surname" id="surname" value="{{data.surname}}" required>
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="national_id">เลขประจำตัวประชาชน <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" placeholder="เลขประจำตัว ปชช. 13 หลัก ..." name="national_id" id="national_id"
                        value="{{session['national_id'] or data.national_id}}" maxlength="13" required
                        {% if data.valid_national_id is defined and not data.valid_national_id %}
                            style="border-color: rgba(244, 92, 92, 1);"
                        {% endif %}
                        {% if 'national_id' in session and session['national_id']!='' %}
                            readonly
                        {% endif %}
                        >
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="cfnational_id">ยืนยันเลขประจำตัวประชาชน <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" placeholder="ยืนยันเลข ปชช. 13 หลัก ..."
                        name="cfnational_id" id="cfnational_id" maxlength="13" required
                        {% if data.valid_national_id is defined and not data.valid_national_id %}
                            style="border-color: rgba(244, 92, 92, 1);"
                        {% endif %}
                        {% if 'register_later' in session %}
                            value="{{session['national_id']}}"
                            readonly
                        {% else %}
                            value="{{data.cfnational_id}}"
                        {% endif %}
                        >
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="job_position">อาชีพ <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" placeholder="อาชีพ..." name="job_position" id="job_position" value="{{data.job_position}}" required>
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2">เพศ <span style="color: red;">*</span></label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sex" id="maleGender" value="M"
                            data-gtm-form-interact-field-id="0" required
                            {% if data.sex=='M' %}checked{% endif %}>
                        <label class="form-check-label" for="maleGender">ชาย</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sex" id="femaleGender" value="F"
                            data-gtm-form-interact-field-id="2" required
                            {% if data.sex=='F' %}checked{% endif %}>
                        <label class="form-check-label" for="femaleGender">หญิง</label>
                    </div>
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="address">ที่อยู่ (ที่พักปัจจุบัน) <span style="color: red;">*</span></label>
                    <textarea class="form-control" placeholder="บ้านเลขที่... หมู่... ตำบล... อำเภอ..." name="address" id="address" cols="50" required>{{data.address}}</textarea>
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="province">จังหวัด (ที่พักปัจจุบัน) <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" placeholder="จังหวัด..." name="province" id="province" value="{{data.province}}" required
                        {% if data.valid_province_name is defined and not data.valid_province_name %}
                            style="border-color: rgba(244, 92, 92, 1);"
                        {% endif %}>
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="email">อีเมล (ถ้ามี)</label>
                    <input type="text" class="form-control" placeholder="อีเมล..." name="email" id="email" value="{{data.email}}">
                </div>
                <div class="form-group py-2">
                    <label class="mr-sm-2" for="phone">เบอร์โทรศัพท์ (ถ้ามี)</label>
                    <input type="text" class="form-control" placeholder="เบอร์โทรศัพท์..." name="phone" id="phone" value="{{data.phone}}" maxlength="10"
                        {% if data.valid_phone is defined and not data.valid_phone %}
                            style="border-color: rgba(244, 92, 92, 1);"
                        {% endif %}>
                </div>
                <div class="form-group py-2">
                    <label for="dob_day">วันเดือนปีเกิด <span style="color: red;">*</span></label>
                    <div class="row">
                        <div class="col-3">
                            <select id="dob_day" name="dob_day" class="form-control">
                                {% if data['dob_day'] %}
                                    <option value="{{ data['dob_day'] }}" selected>{{ data['dob_day'] }}</option>
                                {% endif %}
                                {% for day in range(1, 32) %}
                                    <option value="{{ day }}">{{ day }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-5">
                            <select id="dob_month" name="dob_month" class="form-control">
                                {% set month_list_th = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน','กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'] %}
                                {% if data['dob_month'] %}
                                    <option value="{{ data['dob_month'] }}" selected>{{ month_list_th[data['dob_month'] | int -1] }}</option>
                                {% else %}
                                    <option value="1" selected>มกราคม</option>
                                {% endif %}
                                <option value="2">กุมภาพันธ์</option>
                                <option value="3">มีนาคม</option>
                                <option value="4">เมษายน</option>
                                <option value="5">พฤษภาคม</option>
                                <option value="6">มิถุนายน</option>
                                <option value="7">กรกฎาคม</option>
                                <option value="8">สิงหาคม</option>
                                <option value="9">กันยายน</option>
                                <option value="10">ตุลาคม</option>
                                <option value="11">พฤศจิกายน</option>
                                <option value="12">ธันวาคม</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <select id="dob_year" name="dob_year" class="form-control">
                                {% set current_BE_year = data['current_year']+543 %}
                                {% if data['dob_year'] %}
                                    <option value="{{ data['dob_year'] }}" selected>{{ data['dob_year'] }}</option>
                                    {% for year in range(current_BE_year, current_BE_year-101, -1) %}
                                        <option value="{{ year }}">{{ year }}</option>
                                    {% endfor %}
                                {% else %}
                                    {% for year in range(current_BE_year, current_BE_year-101, -1) %}
                                        {% if year == current_BE_year - 40 %}
                                            <option value="{{ year }}" selected>{{ year }}</option>
                                        {% else %}
                                            <option value="{{ year }}">{{ year }}</option>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                    </div>
                </div>
                {% if data.duplicate_flag is undefined %}
                    <br>
                    <div class="row d-flex justify-content-center">
                        <div class="col d-flex justify-content-center">
                            <a class="btn btn-outline-danger" style="width: 100%;" type="submit" href="/cancel_register">ยกเลิก</a>
                        </div>
                        <div class="col d-flex justify-content-center">
                            <input class="btn btn-success" style="width: 100%;" type="submit" 
                                {% if 'register_later' in session and session['register_later']['order']=='edit-patient' %}
                                    value="ยืนยันการแก้ไข"
                                {% elif 'register_later' in session and session['register_later']['order']=='link-patient' %}
                                    value="ยืนยันการเชื่อมโยง"
                                {% else %}
                                    value="ลงทะเบียน"
                                {% endif %}
                            >
                        </div>
                    </div>
                {% else %}
                    <br>
                    <div class="row d-flex justify-content-center">
                        <div class="col d-flex justify-content-center">
                            <input name="create_new_account" class="btn btn-warning" style="width: 100%;" type="submit" value="สร้างบัญชีใหม่แยก">
                        </div>
                        <div class="col d-flex justify-content-center">
                            <input name="merge_account" class="btn btn-success" style="width: 100%;" type="submit" value="รวมข้อมูลกับบัญชีเดิม">
                        </div>
                    </div>
                    <div class="col d-flex justify-content-center">
                        <a class="btn btn-outline-danger my-2" style="width: 50%;" type="submit" href="/cancel_register">ยกเลิก</a>
                    </div>
                {% endif %}
                
            </form>
        </div>
    </div>
</div>
{% endblock %}