{% extends "./base.html" %}

{% block title %} AIDOC | Submission Records {% endblock %}

{% block content %}

<h2>ระบบการบริหารจัดการภาพของผู้ดูแลระบบ</h2>
<p>ผู้ดูแลระบบ: {{ g.user['name'] }} {{ g.user['surname'] }} (Username: {{ g.user['username'] }}) </p>
    
{% if data|length == 0 %}
    <div class="col-12 mt-2">
        <p class="text-center text-danger">ไม่พบข้อมูล</p>
    </div>
{% else %}
    <div class="mt-2">
        จำนวนรายการทั้งหมด {{dataCount}} รายการ
    </div>
{% endif %}

<!-- Loop through paginated data -->
<div class="row mt-4">
    {% for item in data %}
    
        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 mb-3">
            <div class="card h-100">
                <div class="d-flex justify-content-center align-items-center p-2">
                    <a href="{{ url_for('image.load_image', folder='upload', user_id=item['owner_id'], imagename=item['fname']) }}" target="_blank">
                        <img src="{{ url_for('image.load_image', folder='outlined_thumbnail', user_id=item['owner_id'], imagename=item['fname']) }}" 
                            class="card-img-top rounded" alt="Image Preview" 
                            style="object-fit: contain; width: 100%; height:100%; max-height:250px;"/>
                    </a>
                </div>
                <div class="card-body text-center d-flex flex-column" style="flex: 1;">  
                    <h6 class="fs-6 fw-bold text-primary">
                        ผลการพยากรณ์ของ AI:
                            {% if item['ai_prediction'] == 0 %}
                            <span class="text-dark">Normal</span>
                            {% elif item['ai_prediction'] == 1 %}
                            <span class="text-warning">OPMD</span>
                            {% else %}
                            <span class="text-danger">OPMD</span>
                            {% endif %}
                        </span>
                    </h6>
                    <form action = "{{url_for('webapp.confirmFeedback' , submission_id=item['id']) }}" method="POST">
                        <div class="d-flex gap-2">
                            <select class="form-select form-select-sm" id="feedback" name="feedback" required>
                                <option selected disabled hidden>Feedback</option>
                                <option value="OPMD">OPMD</option>
                                <option value="OSCC">OSCC</option>
                                <option value="Benign">Benign</option>
                                <option value="Others">Others</option>
                                <option value="Normal">Normal</option>
                                <option value="BAD_IMG">ภาพไม่ได้มาตรฐาน</option>
                            </select>
                            <select class="form-select form-select-sm" id ="note" name="note" required>
                                <option selected disabled hidden>Note</option>
                                <option value="พบแพทย์ด่วน">พบแพทย์ด่วน</option>
                                <option value="ตรวจเพิ่มเติม">ตรวจเพิ่มเติม</option>
                                <option value="รอดูอาการ">รอดูอาการ</option>
                                <option value="ปกติ">ปกติ</option>
                                <option value="ภาพเบลอ">ภาพเบลอ</option>
                                <option value="ถ่ายใหม่">ถ่ายใหม่</option>
                            </select>
                            <button class="btn btn-success" type="submit"> Confirm</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    {% endfor %}
</div>


<!-- Pagination links -->
<div class="pagination d-flex justify-content-center align-items-center">
    {% if current_page > 1 %}
        <a href="?page=1" class="btn page-link m-2 text-secondary">&laquo; หน้าแรก</a>
        <a href="?page={{ current_page - 1 }}" class="btn page-link m-2 text-secondary">&lsaquo; ก่อนหน้า</a>
    {% endif %}
    {% for page_num in range(1, total_pages + 1) %}
        {% if page_num == current_page %}
            <span class="current-page page-link m-2 text-secondary">หน้าปัจจุบัน : {{ page_num }} จาก {{ total_pages }}</span>
        {% endif %}
    {% endfor %}
    {% if current_page < total_pages %}
        <a href="?page={{ current_page + 1 }}" class="btn page-link m-2 text-secondary">ถัดไป &rsaquo;</a>
        <a href="?page={{ total_pages }}" class="btn page-link m-2 text-secondary">หลังสุด &raquo;</a>
    {% endif %}
</div>
{% endblock %}

{% block script %}
<script>
    // const filterStatus = document.getElementById("filterStatus");
    // const filterPriority = document.getElementById("filterPriority");
    // const filterProvince = document.getElementById("filterProvince")
    // const filterSpecialist = document.getElementById("filterSpecialist")
    // const filterFollowup = document.getElementById("filterFollowup")
    // const filterRetrain = document.getElementById("filterRetrain")
    
    // Get the filters element and set its value from Flask
    // const filterStatusValue     = "{{ data['filterStatus'] }}";
    // const filterPriorityValue   = "{{ data['filterPriority'] }}";
    // const filterProvinceValue   = "{{ data['filterProvince'] }}";
    // const filterSpecialistValue  = "{{ data['filterSpecialist'] }}";
    // const filterFollowupValue   = "{{ data['filterFollowup'] }}";
    // const filterRetrainValue    = "{{ data['filterRetrain'] }}";

    // Set the selected filters value if it exists
    // if (filterStatusValue) {
    //     filterStatus.value = filterStatusValue;
    // }
    // if (filterPriorityValue) {
    //     filterPriority.value = filterPriorityValue;
    // }
    // if (filterProvinceValue) {
    //     filterProvince.value = filterProvinceValue;
    // }
    // if (filterSpecialistValue) {
    //     filterSpecialist.value = filterSpecialistValue
    // }
    // if (filterFollowupValue) {
    //     filterFollowup.value = filterFollowupValue
    // }
    // if (filterRetrainValue) {
    //     filterRetrain.value = filterRetrainValue
    // }
        
</script>
{% endblock %}