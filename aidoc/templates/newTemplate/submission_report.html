{% extends "./base.html" %}

{% block title %} AIDOC | Submission Report {% endblock %}

{% block content %}
<div id="loadingIndicator" style="display: none; text-align: center; font-weight: bold; font-size: 60px; color: red; ">
  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
</div>
<div id="mainContainer">
  <div id="backgroundFreeze"
    style="position:fixed; top:0; left:0; width:100vw; height:100vh; background-Color: rgba(0, 0, 0, 0.5); z-index:9998; display:none">
  </div>
  <div class="m-3">
    <h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h2>
    <select name="selectedProvince" id="filterProvince" onchange="handleProvinceChange()"></select>
    <svg onclick="fetchSummariesByDay()" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
      class="bi bi-file-earmark-text" viewBox="0 0 16 16" style="cursor: pointer;">
      <path
        d="M9 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-.6-1.4L10.5.6a2 2 0 0 0-1.4-.6zm.5 1.5L13 5H9V1.5zM4 1h5v4H4V1zM3 3v10h10V4H3z" />
    </svg>
    <div id="summaryPopup" class="popup-container"
      style="display: none; position: fixed; top: 10%; left: 10%; width: 80%; height: 80%; background: white; border: 1px solid #ccc; padding: 20px; overflow-y: auto; z-index: 1000;">
      <button onclick="closePopup()" class="btn btn-danger"
        style="position: absolute; top: 10px; right: 10px;">‡∏õ‡∏¥‡∏î</button>
      <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
      <div>
        <label for="startDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</label>
        <input type="date" id="startDate">
        <label for="endDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label>
        <input type="date" id="endDate">
        <svg onclick="fetchSummariesByDay()" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
          fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" style="cursor: pointer;">
          <path
            d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85zm-5.344.656a5 5 0 1 1 0-10 5 5 0 0 1 0 10z" />
        </svg>
        <button onclick="resetDates()"
          style="background: none; border: none; color: inherit; cursor: pointer;">Clear</button>
      </div>
      <br>
      <div class="table-responsive" style="max-height: calc(100% - 100px); overflow-y: auto;">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
              <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏û</th>
            </tr>
          </thead>
          <tbody id="summaryTableBody"></tbody>
        </table>
      </div>
    </div>
    <div class="mt-2">
      <label for="reportStartDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</label>
      <input type="date" id="reportStartDate">
      <label for="reportEndDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label>
      <input type="date" id="reportEndDate">
      <svg onclick="getReportDateRange()" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
        class="bi bi-search" viewBox="0 0 16 16" style="cursor: pointer;">
        <path
          d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85zm-5.344.656a5 5 0 1 1 0-10 5 5 0 0 1 0 10z" />
      </svg>
    </div>
    <div class="card p-3 mt-3" id="xxxcard">
      <h5 class="card-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h5>
      <br>
      <div class="table-responsive">
        <table id="patientHistTable" class="table table-bordered">
          <thead>
            <tr class="text-dark" style="width: 100%;">
              <th rowspan="2" class="align-middle" style="width: 10%;">‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏™‡πà‡∏á</th>
              <th rowspan="2" class="align-middle text-center" style="width: 10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏û</th>
              <th colspan="3" class="text-center" style="width: 20%;">‡∏ú‡∏•‡∏Ñ‡∏≥‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏î‡∏¢ AI</th>
              <th colspan="7" class="text-center" style="width: 60%;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
            </tr>
            <tr>
              <th class="text-center align-middle">OPMD</th>
              <th class="text-center align-middle">OSCC</th>
              <th class="text-center align-middle">NORMAL</th>

              <th class="text-center align-middle" style="width: 7.5%;">OPMD</th>
              <th class="text-center align-middle" style="width: 7.5%;">OSCC</th>
              <th class="text-center align-middle" style="width: 7.5%;">NORMAL</th>
              <th class="text-center align-middle" style="width: 7.5%;">‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</th>
              <th class="text-center align-middle" style="width: 7.5%;">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏á‡∏≠‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</th>
              <th class="text-center align-middle" style="width: 7.5%;">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</th>
              <th class="text-center align-middle" style="width: 7.5%;">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (%)</th>
              <th class="text-center align-middle" style="width: 7.5%;">‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à</th>
            </tr>
          </thead>
          <tbody id=FirstTable>
          </tbody>
        </table>
      </div>
      <br>
    </div>
    <div class="card p-3 mt-3" id="card">
      <h5 class="card-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</h5>
      <br>
      <div class="table-responsive">
        <table id="patientHistTable" class="table table-bordered">
          <thead>
            <tr class="text-dark" style="width: 100%;">
              <th rowspan="2" class="align-middle" style="width: 10%;">‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏™‡πà‡∏á</th>
              <th rowspan="2" class="align-middle text-center" style="width: 10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏û</th>
              <th colspan="3" class="text-center" style="width: 30%;">‡∏ú‡∏•‡∏Ñ‡∏≥‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏î‡∏¢ AI</th>
              <th colspan="7" class="text-center" style="width: 50%;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Ç‡∏≠‡∏á AI</th>
            </tr>
            <tr>
              <th class="text-center align-middle">OPMD</th>
              <th class="text-center align-middle">OSCC</th>
              <th class="text-center align-middle">NORMAL</th>
              <th class="text-center align-middle" style="width: 30%;">Agree</th>
              <th class="text-center align-middle" style="width: 30%;">Dissagree</th>
            </tr>
          </thead>
          <tbody id="specialistTable">
          </tbody>
        </table>
      </div>
    </div>
    <div class="card p-3 mt-3" id="card">
      <div class="table-responsive">
        <table id="summaryTable" class="table table-bordered">
          <thead>
            <tr class="text-dark" style="width: 100%;">
              <th rowspan="2" style="width: 40%;" class="align-middle">‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                ‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏™‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏ô‡∏ï‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</th>
              <th rowspan="2" style="width: 20%;" class="align-middle text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏û</th>
              <th colspan="3" style="width: 40%;" class="text-center">‡∏ú‡∏•‡∏Ñ‡∏≥‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏î‡∏¢ AI</th>
            </tr>
            <tr>
              <th class="text-center">OPMD</th>
              <th class="text-center">OSCC</th>
              <th class="text-center">NORMAL</th>
            </tr>
          </thead>
          <tbody id="pictureCountTable">
          </tbody>
        </table>
      </div>
    </div>
    <div class="card p-3 mt-3" id="card">
      <h5 class="card-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h5>
      <br>
      <div class="table-responsive">
        <table id="countAcc" class="table table-bordered">
          <thead>
            <tr class="text-dark" style="width: 100%;">
              <th rowspan="2" class="align-middle" style="width: 40%;">
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
              <th rowspan="2" class="align-middle text-center" style="width: 20%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
              <th colspan="2" class="text-center" style="width: 40%;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
            </tr>
            <tr>
              <th class="text-center align-middle">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ</th>
              <th class="text-center align-middle">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ</th>
            </tr>
          </thead>
          <tbody id="countAccTable">
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
  let isProvincePopulated = false;
  getReport("‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®", null, null);
  // Function to get the report
  function getReport(province, startDate, endDate) {
    const role = 'admin';
    const loadingIndicator = document.getElementById('loadingIndicator');
    const mainContent = document.getElementById('mainContainer');
    mainContent.style.display = 'none';
    loadingIndicator.style.display = 'block';

    // Build the URL with query parameters
    let url = '/report_api/';
    let params = [];

    if (province && province !== "‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®") {
      params.push(`province=${province}`);
    }
    if (startDate) {
      params.push(`start_date=${startDate}`);
    }
    if (endDate) {
      params.push(`end_date=${endDate}`);
    }

    // Add query parameters to URL if they exist
    if (params.length > 0) {
      url += '?' + params.join('&');
    }

    // Make the API call
    fetch(url, {
      method: 'GET',
      headers: {
        'x-role': role,
        'Content-Type': 'application/json',
      },
    })
      .then((response) => response.json())
      .then((data) => {
        populateProvince(data);
        populateFirstTable(data);
        populateSpecialistTable(data);
        populatePictureCountTable(data);
        populateCountAcc(data);
      })
      .catch((error) => {
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
      })
      .finally(() => {
        mainContent.style.display = 'block';
        loadingIndicator.style.display = 'none';
      });
  }

  function handleProvinceChange() {
    const province = document.getElementById('filterProvince').value;
    const startDate = document.getElementById('reportStartDate').value;
    const endDate = document.getElementById('reportEndDate').value;
    getReport(province, startDate, endDate);
  }


  function populateFirstTable(data) {
    const firstTable = document.getElementById('FirstTable');
    firstTable.innerHTML = ''; // Clear existing rows if any

    if (data.patient_and_osm) {
      // Extract osm, patient, and total data
      const { osm, patient, total } = data.patient_and_osm;
      const createRow = (label, entry) => {
        const row = document.createElement('tr');
        row.innerHTML = `
        <td>${label}</td>
        <td class="text-center">
          <button type="submit" 
                  style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
                  onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}')">
            ${entry.total_pic} 
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}', '1')">
            ${entry.ai_predict.opmd}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}', '2')">
            ${entry.ai_predict.oscc}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}', '0')">
            ${entry.ai_predict.normal}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}', null , 'OPMD')">
            ${entry.dentist_diagnose.opmd}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}',  null , 'OSCC')">
            ${entry.dentist_diagnose.oscc}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}', null , 'NORMAL')">
            ${entry.dentist_diagnose.normal}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}',  null , 'BAD_IMG')">
            ${entry.dentist_diagnose.poor_image}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}',  null , 'BENIGN')">
            ${entry.dentist_diagnose.benign}
          </button>
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}',  null , 'OTHER')">
            ${entry.dentist_diagnose.others}
          </button>
        </td>
        <td class="text-center">
              ${entry.accuracy}
        </td>
        <td class="text-center">
          <button type="submit" style="text-decoration: none; color: black; background: none; border: none; cursor: pointer;"
          onclick="storeFilterValue('${label === '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'BOTH' : (label === '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô' ? 'PATIENT' : 'OSM')}', null, null, '0')">
            ${entry.dentist_diagnose.not_diagnosed}
          </button>
        </td>

      `;
        firstTable.appendChild(row);
      };

      // Add rows for osm, patient, and total
      createRow('‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô', patient);
      createRow('‡∏≠‡∏™‡∏°.', osm);
      createRow('‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', total);
    }
  }
  function populateSpecialistTable(data) {
    const specialistTable = document.getElementById('specialistTable');
    specialistTable.innerHTML = ''; // Clear existing rows if any

    if (data.specialist && Array.isArray(data.specialist)) {
      data.specialist.forEach((specialist, index) => {
        const isLastSpecialist = index === data.specialist.length - 1
        const row = document.createElement('tr');

        // Populate cells for the current specialist
        row.innerHTML = `
        <td>${isLastSpecialist ? '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : specialist.job}</td>
        <td class="text-center">${specialist.total_pic}</td>
        <td class="text-center">${specialist.ai_predict.opmd}</td>
        <td class="text-center">${specialist.ai_predict.oscc}</td>
        <td class="text-center">${specialist.ai_predict.normal}</td>
        <td class="text-center" >${specialist.dentist_diagnose.agree}</td>
        <td class="text-center">${specialist.dentist_diagnose.disagree}</td>
      `;

        specialistTable.appendChild(row);
      });
    }
  }

  function populatePictureCountTable(data) {
    const pictureCountTable = document.getElementById('pictureCountTable')
    pictureCountTable.innerHTML = ''
    if (data.total_pic) {
      const row = document.createElement('tr')
      row.innerHTML = `
    <td>‡∏£‡∏ß‡∏°</td>
    <td class="text-center">${data.total_pic.total_pic}</td>
    <td class="text-center">${data.total_pic.ai_predict.opmd}</td>
    <td class="text-center">${data.total_pic.ai_predict.oscc}</td>
    <td class="text-center">${data.total_pic.ai_predict.normal}</td>
    `

      pictureCountTable.appendChild(row);
    }
  }

  function populateProvince(data) {
    const provinceDropdown = document.getElementById('filterProvince');

    if (!isProvincePopulated && provinceDropdown.options.length <= 1) {
      const defaultOption = document.createElement('option');
      defaultOption.value = "‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®";
      defaultOption.textContent = "‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®";
      provinceDropdown.appendChild(defaultOption);

      let count = 1;
      data.total_province.forEach(province => {
        const option = document.createElement('option');
        option.value = province;

        // Add medal emoji for the first three provinces
        if (count === 1) {
          option.textContent = "ü•á " + province;
        } else if (count === 2) {
          option.textContent = "ü•à " + province;
        } else if (count === 3) {
          option.textContent = "ü•â " + province;
        } else {
          option.textContent = province;
        }

        provinceDropdown.appendChild(option);
        count++;
      });

      isProvincePopulated = true;
    }
  }

  function populateCountAcc(data) {
    const countAcc = document.getElementById('countAccTable')
    countAcc.innerHTML = ''
    if (data.total_account) {
      data.total_account.forEach((category, idx) => {
        const isLastCategory = idx === data.total_account.length - 1
        const row = document.createElement('tr')
        row.innerHTML = `
        <td>${category.job_category}</td>
        <td class="text-center">${category.total_users}</td>
        <td class="text-center">${category.submitted_users}</td>
        <td class="text-center">${category.not_submitted_users}</td>
      `;
        countAcc.appendChild(row)
      })
    }
  }


  function fetchSummariesByDay() {
    const province = document.getElementById('filterProvince').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    let url = '/summaries_by_day/';
    let params = [];

    if (province !== '‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®') {
      params.push(`province=${province}`);
    }
    if (startDate) {
      params.push(`start_date=${startDate}`);
    }
    if (endDate) {
      params.push(`end_date=${endDate}`);
    }

    if (params.length) {
      url += '?' + params.join('&');
    }

    document.body.style.overflow = 'hidden';  // Prevent scrolling
    const backgroundFreeze = document.getElementById('backgroundFreeze');
    backgroundFreeze.style.display = 'block';

    // Show the popup
    const summaryPopup = document.getElementById('summaryPopup');
    summaryPopup.style.display = 'block';
    summaryPopup.style.zIndex = '9999';  // Ensure popup is above the background freeze

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const tableBody = document.getElementById('summaryTableBody');
        tableBody.innerHTML = '';
        data.forEach(entry => {
          const row = document.createElement('tr');
          row.innerHTML = `<td>${new Date(entry.date).toLocaleDateString()}</td>
      <td>${entry.province}</td>
      <td>${entry.count}</td>`;
          tableBody.appendChild(row);
        });
      })
      .catch(error => {
        console.error('Error fetching summaries:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
      });
  }



  function closePopup() {
    // Hide the popup
    document.getElementById('summaryPopup').style.display = 'none';

    // Restore background and scrolling
    document.body.style.overflow = '';  // Allow scrolling again
    document.getElementById('backgroundFreeze').style.display = 'none';
  }

  function resetDates() {
    // Reset the date fields
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';

    // Optionally, reset the background freeze in case it's still active
    if (document.getElementById('backgroundFreeze')) {
      document.body.style.overflow = '';  // Allow scrolling again
    }
  }

  function getReportDateRange() {
    const startDate = document.getElementById('reportStartDate').value;
    const endDate = document.getElementById('reportEndDate').value;
    const province = document.getElementById('filterProvince').value;
    getReport(province, startDate, endDate);
  }

  function storeFilterValue(channel, aiPrediction = null, dentistFeedback = null, isChecked = null) {
    // Store the value in localStorage or sessionStorage
    localStorage.setItem('selectedChannel', channel);
    if (aiPrediction) {
      localStorage.setItem('selectedAiPrediction', aiPrediction);
    }
    if (dentistFeedback) {
      localStorage.setItem('selectedDentistFeedback', dentistFeedback);
    }
    if (isChecked !== null) {
      localStorage.setItem('selectedDentistChecked', isChecked);
    }
    // If you want to use sessionStorage instead of localStorage, replace with sessionStorage.setItem
    window.location.href = '/admin_record2';  // Navigate to the next page
  }

</script>
{% endblock %}